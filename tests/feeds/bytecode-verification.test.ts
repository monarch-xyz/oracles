import { describe, expect, it } from "vitest";
import { isPendleLinearDiscountFeedBytecode } from "../../src/sources/pendleFeedDetector.js";

/**
 * Paste real deployed bytecodes here.
 * Use full hex with 0x prefix.
 */
const REAL_PENDLE_FEED_BYTECODE =
  "0x6080806040526004361015610012575f80fd5b5f3560e01c908163313ce567146101f857508063ea56d3db1461018a5763feaf968c1461003d575f80fd5b34610173575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc360112610173576040517ffeaf968c00000000000000000000000000000000000000000000000000000000815260a08160048173ffffffffffffffffffffffffffffffffffffffff7f0000000000000000000000008509ff79d9ca53f5a5c41544b9e713cc98ee7fa8165afa90811561017f575f905f5f915f94610114575b509269ffffffffffffffffffff9160a094836040519516855260208501526040840152426060840152166080820152f35b935050505060a0813d60a011610177575b8161013260a093836102e0565b81010312610173578069ffffffffffffffffffff61015160a09361034e565b9160208101519261016960806040840151930161034e565b94509290916100e3565b5f80fd5b3d9150610125565b6040513d5f823e3d90fd5b34610173575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261017357602060405173ffffffffffffffffffffffffffffffffffffffff7f0000000000000000000000008509ff79d9ca53f5a5c41544b9e713cc98ee7fa8168152f35b34610173575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc360112610173577f313ce56700000000000000000000000000000000000000000000000000000000815260208160048173ffffffffffffffffffffffffffffffffffffffff7f0000000000000000000000008509ff79d9ca53f5a5c41544b9e713cc98ee7fa8165afa801561017f575f906102a3575b60209060ff60405191168152f35b506020813d6020116102d8575b816102bd602093836102e0565b81010312610173575160ff8116810361017357602090610295565b3d91506102b0565b90601f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0910116810190811067ffffffffffffffff82111761032157604052565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b519069ffffffffffffffffffff821682036101735756fea2646970667358221220ff5fe8c76ec21ed4777097f5520a3819e2f1a28344938b950c70281fd22ff52464736f6c634300081e0033";
const REAL_PENDLE_FEED_BYTECODE_2 =
  "0x6080806040526004361015610012575f80fd5b5f3560e01c908163313ce567146101f857508063ea56d3db1461018a5763feaf968c1461003d575f80fd5b34610173575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc360112610173576040517ffeaf968c00000000000000000000000000000000000000000000000000000000815260a08160048173ffffffffffffffffffffffffffffffffffffffff7f000000000000000000000000d69aaa141e63adfa1399075fb9533741a2985fa7165afa90811561017f575f905f5f915f94610114575b509269ffffffffffffffffffff9160a094836040519516855260208501526040840152426060840152166080820152f35b935050505060a0813d60a011610177575b8161013260a093836102e0565b81010312610173578069ffffffffffffffffffff61015160a09361034e565b9160208101519261016960806040840151930161034e565b94509290916100e3565b5f80fd5b3d9150610125565b6040513d5f823e3d90fd5b34610173575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261017357602060405173ffffffffffffffffffffffffffffffffffffffff7f000000000000000000000000d69aaa141e63adfa1399075fb9533741a2985fa7168152f35b34610173575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc360112610173577f313ce56700000000000000000000000000000000000000000000000000000000815260208160048173ffffffffffffffffffffffffffffffffffffffff7f000000000000000000000000d69aaa141e63adfa1399075fb9533741a2985fa7165afa801561017f575f906102a3575b60209060ff60405191168152f35b506020813d6020116102d8575b816102bd602093836102e0565b81010312610173575160ff8116810361017357602090610295565b3d91506102b0565b90601f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0910116810190811067ffffffffffffffff82111761032157604052565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b519069ffffffffffffffffffff821682036101735756fea2646970667358221220ff5fe8c76ec21ed4777097f5520a3819e2f1a28344938b950c70281fd22ff52464736f6c634300081e0033";

describe("feed bytecode verification", () => {
  it("validates Pendle linear discount feed bytecode", () => {
    expect(isPendleLinearDiscountFeedBytecode(REAL_PENDLE_FEED_BYTECODE)).toBe(true);
  });

  it("validates second Pendle linear discount feed bytecode", () => {
    expect(isPendleLinearDiscountFeedBytecode(REAL_PENDLE_FEED_BYTECODE_2)).toBe(true);
  });

  it.todo("validates Pendle Chainlink Oracle feed bytecode");
});
